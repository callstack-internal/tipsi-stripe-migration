var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _dotenv=_interopRequireDefault(require("dotenv"));var _bodyParser=_interopRequireDefault(require("body-parser"));var _express=_interopRequireDefault(require("express"));var _stripe=_interopRequireDefault(require("stripe"));_dotenv.default.config({path:'./.env'});var stripePublishableKey=process.env.STRIPE_PUBLISHABLE_KEY||'';var stripeSecretKey=process.env.STRIPE_SECRET_KEY||'';var app=(0,_express.default)();app.use(function(req,res,next){if(req.originalUrl==='/webhook'){next();}else{_bodyParser.default.json()(req,res,next);}});app.get('/stripe-key',function(req,res){return res.send({publishableKey:stripePublishableKey});});app.post('/create-payment-intent',function _callee(req,res){var _req$body,email,currency,stripe,customer,params,paymentIntent;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_req$body=req.body,email=_req$body.email,currency=_req$body.currency;stripe=new _stripe.default(stripeSecretKey,{apiVersion:'2020-08-27',typescript:true});_context.next=4;return _regenerator.default.awrap(stripe.customers.create({email:email}));case 4:customer=_context.sent;params={amount:1400,currency:currency,customer:customer.id,payment_method_options:{card:{request_three_d_secure:'automatic'}}};_context.prev=6;_context.next=9;return _regenerator.default.awrap(stripe.paymentIntents.create(params));case 9:paymentIntent=_context.sent;return _context.abrupt("return",res.send({clientSecret:paymentIntent.client_secret}));case 13:_context.prev=13;_context.t0=_context["catch"](6);return _context.abrupt("return",res.send({error:_context.t0.raw.message}));case 16:case"end":return _context.stop();}}},null,null,[[6,13]],Promise);});app.post('/create-setup-intent',function _callee2(req,res){var _req$body2,email,_req$body2$payment_me,payment_method_types,stripe,customer,setupIntent;return _regenerator.default.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_req$body2=req.body,email=_req$body2.email,_req$body2$payment_me=_req$body2.payment_method_types,payment_method_types=_req$body2$payment_me===void 0?[]:_req$body2$payment_me;stripe=new _stripe.default(stripeSecretKey,{apiVersion:'2020-08-27',typescript:true});_context2.next=4;return _regenerator.default.awrap(stripe.customers.create({email:email}));case 4:customer=_context2.sent;_context2.next=7;return _regenerator.default.awrap(stripe.setupIntents.create({customer:customer.id,payment_method_types:payment_method_types}));case 7:setupIntent=_context2.sent;return _context2.abrupt("return",res.send({publishableKey:process.env.STRIPE_PUBLISHABLE_KEY,clientSecret:setupIntent.client_secret}));case 9:case"end":return _context2.stop();}}},null,null,null,Promise);});app.listen(4242,function(){return console.log("Node server listening on port "+4242+"!");});
//# sourceMappingURL=index.js.map